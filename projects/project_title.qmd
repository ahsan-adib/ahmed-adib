---
title: "Himalayan expedition data"
author: Ahmed A. Adib
date: 2025-07-22
draft: false
editor-options:
  chunk_output_type: inline
---

## Packages used

```{r}
#| label: load-packages
#| output: false

library(tidyverse)
library(tidytuesdayR)
```

## Get the data

```{r}
#| label: get-data
#| output: false
himalayan.data = tidytuesdayR::tt_load(2025, week = 3)
```

Assign different data to different variables

```{r}
exped.data = himalayan.data$exped_tidy
peak.data = himalayan.data$peaks_tidy
```

Check the data

```{r}
head(exped.data)
colnames(exped.data)
```

## Disclaimer

Since 8000 meter peaks are the most prestigious ones in terms of mountaineering, we will create a separate data file containing only the 8k peaks. First, get the names of the peaks from the `peak.data` file.

```{r}
peak_8k_names = peak.data |> filter(HEIGHTM >= 8000) |> pull(PEAKID)
```

Just to know the names of the peaks, we can extract the `PKNAME` instead of `PEAKID`

```{r}
peak.data |> filter(HEIGHTM >= 8000) |> pull(PKNAME)
```

We can see there are 16 different names. If you are into mountaineering, you can see some famous names are missing, like `K2`, second highest peak in the world. These peaks are missing due to its presence in a different mountain range (Karakoram), instead of Himalayan range.

Now we extract the expedition details of these 8k peaks.

```{r}
exped.8k = exped.data |> filter(PEAKID %in% peak_8k_names)
```

## Questions

### 1. What is the most successful route for the expedition for 8k peaks?

There are 4 different routes enlisted for each peaks, assigned by `ASCENT1`, `ASCENT2`, `ASCENT3` and `ASCENT4`. The succesful climbing in these routes are stored in corresponding logical vector `SUCCESS1`, `SUCCESS2`, `SUCCESS3`, `SUCCESS4`. We will use these SUCCESS data along with the `exped.8k` dataset.
```{r}
exped.8k |> pivot_longer(cols = c(SUCCESS1, SUCCESS2, SUCCESS3, SUCCESS4),
                           names_to = "route_success",
                           values_to = "success") |>
  group_by(route_success) |>
  summarise(success_rate = (mean(success, na.rm = TRUE))*100) |>
  ggplot(aes(x = route_success, y = success_rate, fill = route_success)) +
  geom_col(width = 0.6, color = "black") +
  labs(
    title = "Success rate by route",
    x = "Route (1-4)",
    y = "Success rate (%)"
  )
```

### 2. Which countries has lead the most successful expedition?

Again, we will use the `SUCCESS` vector; now with the `NATION` vector; with the `exped.data` for the details of the all peaks.

```{r}
#| fig-width: 10
#| fig-height: 12
#| warning: false
exped.data |> filter(SUCCESS1 == TRUE | SUCCESS2 == TRUE | SUCCESS3 == TRUE | SUCCESS4 == TRUE) |>
  count(NATION, sort = TRUE) |>
  ggplot(aes(x = reorder(NATION, n), y = n)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = n), hjust = -0.1, size = 3) +
  labs(
    title = "Successful expedition by nation",
    x = "Nation",
    y = "Number of successful expedition"
    ) +
  coord_flip()
```

#### What about the 8k peaks

```{r}
#| fig-width: 10
#| fig-height: 12
#| warning: false
exped.8k |> filter(SUCCESS1 == TRUE | SUCCESS2 == TRUE | SUCCESS3 == TRUE | SUCCESS4 == TRUE) |>
  count(NATION, sort = TRUE) |>
  ggplot(aes(x = reorder(NATION, n), y = n)) +
  geom_col(fill = "orangered4") +
  geom_text(aes(label = n), hjust = -0.1, size = 3) +
  labs(
    title = "Successful expedition by nation on 8k peaks",
    x = "Nation",
    y = "Number of successful expedition"
  ) +
  coord_flip()
```

#### What about the one we actually care about (`Everest`)

```{r}
#| fig-width: 10
#| fig-height: 10
#| warning: false
exped.8k |> filter(SUCCESS1 == TRUE | SUCCESS2 == TRUE | SUCCESS3 == TRUE | SUCCESS4 == TRUE) |>
  filter(PEAKID == "EVER") |>
  count(NATION, sort = TRUE) |>
  ggplot(aes(x = reorder(NATION, n), y = n)) +
  geom_col(fill = "lightsalmon3") +
  geom_text(aes(label = n), hjust = -0.1, size = 3) +
  labs(
    title = "Successful expedition by nation on Everest",
    x = "Nation",
    y = "Number of successful expedition"
  ) +
  coord_flip()
```

### 3. How does the travel time vary in different seasons?

```{r}
exped.data |> filter(!is.na(TOTDAYS), !is.na(SEASON_FACTOR)) |>
  ggplot(aes(x = SEASON_FACTOR, y = TOTDAYS, fill = SEASON_FACTOR)) +
  geom_jitter(aes(colour = SEASON_FACTOR)) +
  scale_color_viridis_d(alpha = 1) +
  labs(
    title = "Expedition duration by season",
    x = "Season",
    y = "Total days of expedition"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

### 4. Most common reasons for expedition termination

```{r}
#| fig-width: 14
#| fig-height: 6
#| warning: false
exped.data |> count(TERMREASON_FACTOR, sort=TRUE) |>
  ggplot(aes(x = reorder(TERMREASON_FACTOR,n), y = n, fill = n)) +
  geom_col() + geom_text(aes(label = n, hjust = -0.5)) +
  coord_flip() +
  labs(
    title = "Common reasons for expedition termination",
    x = "Number",
    y = "Reasons"
  )
```

### 5. Which peak has the highest fatality rate?

```{r}
exped.data |> left_join(select(peak.data, PEAKID, PKNAME), by = "PEAKID") |>
  group_by(PKNAME) |>
  summarise(
    expeditions = n(),
    total.deaths = sum(MDEATHS+HDEATHS),
    fatality.rate = total.deaths / expeditions) |>
  arrange(fatality.rate) |>
  slice_max(fatality.rate, n = 10) |>
  ggplot(aes(x = reorder(PKNAME, fatality.rate), y = fatality.rate)) +
  geom_col(fill = "maroon") +
  coord_flip() +
  labs(
    title = "Fatality rate in himalayan peaks",
    x = "Peak name",
    y = "Fatality rate"
  ) +
  theme_minimal()
```

#### Among the 8k peaks

```{r}
exped.8k |> left_join(select(peak.data, PEAKID, PKNAME), by = "PEAKID") |>
  group_by(PKNAME) |>
  summarise(
    expeditions = n(),
    total.deaths = sum(MDEATHS+HDEATHS),
    fatality.rate = total.deaths / expeditions) |>
  arrange(fatality.rate) |>
  #slice_max(fatality.rate, n = 10) |>
  ggplot(aes(x = reorder(PKNAME, fatality.rate), y = fatality.rate)) +
  geom_col(fill = "firebrick3") +
  coord_flip() +
  labs(
    title = "Fatality rate in 8k peaks",
    x = "Peak name",
    y = "Fatality rate"
  ) +
  theme_minimal()
```

#### In case of number of fatalities on the peaks

```{r}
exped.data |> left_join(select(peak.data, PEAKID, PKNAME), by = "PEAKID") |>
  group_by(PKNAME) |>
  summarise(total.deaths = sum(MDEATHS+HDEATHS)) |>
  arrange(total.deaths) |>
  slice_max(total.deaths, n = 10) |>
  ggplot(aes(x = reorder(PKNAME, total.deaths), y = total.deaths)) +
  geom_col(fill = "red4") +
  coord_flip() +
  labs(
    title = "Number of deaths in himalayan peaks",
    x = "Peak name",
    y = "No. of death"
  ) +
  geom_text(aes(label = total.deaths), hjust = -.3) +
  theme_minimal()
```

### 6. Does the use of supplemental oxygen affect the success rate?

```{r}
exped.data |> mutate(success = SUCCESS1 | SUCCESS2 | SUCCESS3 | SUCCESS4) |>
  group_by(O2USED) |>
  summarise(success.rate = (mean(success, na.rm = TRUE))) |>
  ggplot(aes(x = O2USED, y = success.rate, fill = O2USED)) +
  geom_col(width = 0.3) +
  geom_text(aes(label = scales::percent(success.rate, accuracy = 0.1), vjust = -0.5,  size = 4)
) +
  theme(legend.position = "none") +
  labs(
    title = "Success rate with supplemental oxygen",
    x = "Oxygen used",
    y = "Success rate")
```

### 7. Are commercial or standard routes more frequently involved in accidents?

```{r}
exped.data |>
  mutate(accident = !is.na(ACCIDENTS)) |>
  group_by(COMRTE, STDRTE) |>
  summarise(
    accident_rate = scales::percent(mean(accident, na.rm = TRUE)),
    total = n()
  )
```
